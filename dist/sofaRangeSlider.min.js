/**
 * angular-sofa-range-slider - v0.1.0 - Thu Mar 05 2015 11:03:44 GMT+0100 (CET)
 * http://www.sofa.io
 *
 * Copyright (c) 2014 CouchCommerce GmbH (http://www.couchcommerce.com / http://www.sofa.io) and other contributors
 * THIS SOFTWARE CONTAINS COMPONENTS OF THE SOFA.IO COUCHCOMMERCE SDK (WWW.SOFA.IO)
 * IT IS PROVIDED UNDER THE LICENSE TERMS OF THE ATTACHED LICENSE.TXT.
 */
!function(n){n.module("sofa-range-slider.tpl.html",[]).run(["$templateCache",function(n){n.put("sofa-range-slider.tpl.html",'<div class="sofa-range-slider-wrapper">\n    <span ng-bind="displayFn(rangeStart)" class="sofa-range-slider-label--start"></span>\n    <span ng-bind="displayFn(rangeEnd)" class="sofa-range-slider-label--end"></span>\n    <div class="sofa-range-slider">\n        <div class="sofa-range-slider__handle--start"></div>\n        <span class="sofa-range-slider__range"></span>\n        <div class="sofa-range-slider__handle--end"></div>\n    </div>\n</div>')}]),n.module("sofa.rangeSlider",["sofa-range-slider.tpl.html"]).directive("sofaRangeSlider",function(){"use strict";if(!n.isFunction(Hammer))throw new Error("Hammer.js is missing");var a="transform";["webkit","Moz","O","ms"].every(function(n){var t=n+"Transform";return void 0!==window.document.body.style[t]?(a=t,!1):!0});var t=function(n){return n.offsetWidth>0};return{restrict:"E",replace:!0,scope:{model:"=",minLimit:"=",maxLimit:"=",step:"=?",displayValueExp:"&?"},templateUrl:"sofa-range-slider.tpl.html",link:function(e,i){var r,s=i[0].querySelector(".sofa-range-slider__handle--start"),l=i[0].querySelector(".sofa-range-slider__handle--end"),o=i[0].querySelector(".sofa-range-slider"),d=i[0].querySelector(".sofa-range-slider__range");e.model||(e.model={min:e.minLimit,max:e.maxLimit}),e.rangeStart=e.model.min,e.rangeEnd=e.model.max;var m=function(){return{totalWidth:o.getBoundingClientRect().width,handleWidth:s.getBoundingClientRect().width}};if(r=m(),0===r.totalWidth)var p=e.$watch(function(){return t(o)},function(n){n&&(r=m(),h(),p())});var u={min:0,max:0},f=function(n,a){u[n]=a};e.displayFn=function(a){return n.isFunction(e.displayValueExp)?e.displayValueExp({value:a}):a};var c=function(n,t,e,i,r){if(!t)return!1;var o,d,m,p,u,c,h=t.min,g=t.max;return m=100*h/i,p=100*g/i,o=parseInt(n/100*m,10),d=-(n-parseInt(n/100*p,10)),u=parseInt(i/100*m,10),c=parseInt(i/100*p,10),r&&[o,d,u,c].forEach(function(n){n=Math.round(n*r)/r}),s.style[a]="translateX("+o+"px)",l.style[a]="translateX("+d+"px)",f("min",o),f("max",d),{startPosition:o,endPosition:d,minLimit:u,maxLimit:c}},h=function(){var n=c(r.totalWidth,e.model,e.minLimit,e.maxLimit,e.step);e.rangeStart=n?n.minLimit:e.minLimit,e.rangeEnd=n?n.maxLimit:e.maxLimit,d.style.left=n?n.startPosition+"px":"0",d.style.right=n?Math.abs(n.endPosition)+"px":"0"};r.totalWidth>0&&h();var g=function(n,a){var t,i;"min"===n?(t=100*a/r.totalWidth,i=parseInt(e.maxLimit/100*t,10),e.step&&(i=Math.round(i/e.step)*e.step),e.$apply(function(){e.rangeStart=i}),d.style.left=a+"px"):(t=100*(r.totalWidth+a)/r.totalWidth,i=parseInt(e.maxLimit/100*t,10),e.step&&(i=Math.round(i/e.step)*e.step),e.$apply(function(){e.rangeEnd=i}),d.style.right=Math.abs(a)+"px")},v=function(){e.$apply(function(){e.model={min:e.rangeStart,max:e.rangeEnd}})};e.$watch("model",function(n,a){n!==a&&h()},!0);var x=function(n,t,e,i){var s,l,o;"min"===n?(s=u.min+e,l=0,o=r.totalWidth-Math.abs(u.max)-2*r.handleWidth,l>s?s=l:s>o&&(s=o),g(n,s)):(s=u.max+e,l=-(r.totalWidth-u.min-2*r.handleWidth),o=0,l>s?s=l:s>o&&(s=o),g(n,s)),t.style[a]="translateX("+s+"px)",i&&(f(n,s),v())},y=new Hammer.Manager(s),L=new Hammer.Manager(l),w={direction:Hammer.DIRECTION_HORIZONTAL,threshold:10,touchAction:"pan"},W=new Hammer.Pan(w),_=new Hammer.Pan(w);y.add(W),L.add(_),y.on("panmove panend",function(n){n.preventDefault(),x("min",s,parseInt(n.deltaX,10),"panend"===n.type)}),L.on("panmove panend",function(n){n.preventDefault(),x("max",l,parseInt(n.deltaX,10),"panend"===n.type)})}}})}(angular);